<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CampLoci â€“ Connect, Trade, Share</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .category-btn.active {
      background: linear-gradient(to right, #2563eb, #0891b2);
      color: white;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,.1);
    }
    .image-preview { max-width:100%; max-height:200px; object-fit:cover; border-radius:8px; }
    .post-image    { max-width:100%; border-radius:12px; margin-top:12px; }
    .comment-box   { background:#f8fafc; border-radius:10px; padding:10px 14px; margin-top:6px; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-cyan-50 to-sky-50 min-h-screen">

  <!-- â”€â”€ HEADER â”€â”€ -->
  <div class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold mb-1">ğŸ“ CampLoci</h1>
      <p class="text-blue-100 text-sm">Connect with student entrepreneurs and share your campus life</p>
    </div>
  </div>

  <!-- â”€â”€ INSTITUTION FILTER â”€â”€ -->
  <div class="bg-white shadow-md border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Select Your Institution</label>
      <select id="institutionSelect" class="w-full md:w-96 px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <option value="">All Institutions</option>
      </select>
    </div>
  </div>

  <!-- â”€â”€ MAIN TABS â”€â”€ -->
  <div class="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex space-x-8">
        <button onclick="switchMainTab('market')"    id="marketMainTab"    class="py-4 px-2 font-medium border-b-2 border-blue-600 text-blue-600 transition-colors">ğŸ›ï¸ Market</button>
        <button onclick="switchMainTab('socialize')" id="socializeMainTab" class="py-4 px-2 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition-colors">ğŸ“¸ Socialize</button>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 py-8">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MARKET SECTION                                        -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="marketSection">
      <div class="bg-white border-b border-gray-200 -mx-4 px-4 mb-6">
        <div class="flex space-x-8">
          <button onclick="switchMarketTab('browse')" id="browseTab" class="py-4 px-2 font-medium border-b-2 border-blue-600 text-blue-600 transition-colors">Browse Businesses</button>
          <button onclick="switchMarketTab('list')"   id="listTab"   class="py-4 px-2 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition-colors">â• List Your Business</button>
        </div>
      </div>

      <!-- Browse -->
      <div id="browseSection">
        <div class="mb-6 relative">
          <svg class="absolute left-4 top-3.5 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input type="text" id="searchInput" placeholder="Search businessesâ€¦" class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div class="mb-8 overflow-x-auto">
          <div id="categoriesContainer" class="flex space-x-2 pb-2"></div>
        </div>
        <div id="businessesGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <div id="noResults" class="text-center py-12 hidden">
          <div class="text-6xl mb-4">ğŸ”</div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">No businesses found</h3>
          <p class="text-gray-500">Try adjusting your filters or search terms</p>
        </div>
      </div>

      <!-- List a business form -->
      <div id="listSection" class="hidden">
        <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">List Your Business</h2>
          <div class="space-y-6">
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Business Name *</label>
                <input type="text" id="businessName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Campus Tutors Pro">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Your Name *</label>
                <input type="text" id="ownerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., John Doe">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Institution *</label>
              <select id="businessInstitution" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">Select your institution</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
              <select id="businessCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
              <textarea id="businessDescription" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Describe your business, services, and what makes you uniqueâ€¦"></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Upload Image</label>
              <input type="file" id="businessImage" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <div id="businessImagePreview" class="mt-2"></div>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Location *</label>
                <input type="text" id="businessLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Main Campus, Building 3">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Price *</label>
                <input type="text" id="businessPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., R150/hour or From R50">
              </div>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Contact Number *</label>
                <input type="tel" id="businessContact" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., 073 456 7890">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Availability *</label>
                <input type="text" id="businessAvailability" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Mon-Fri, 18:00-21:00">
              </div>
            </div>
            <div class="flex space-x-4">
              <button onclick="submitBusiness()" class="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-cyan-700 transition-all shadow-md hover:shadow-lg">â• List Business</button>
              <button onclick="switchMarketTab('browse')" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /marketSection -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- SOCIALIZE SECTION                                     -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="socializeSection" class="hidden">

      <!-- New-post form -->
      <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Share Your Campus Memory ğŸ“¸</h2>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Select Institution *</label>
          <select id="postInstitution" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            <option value="">Choose your institution</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Your Name *</label>
          <input type="text" id="postAuthor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Thabo M. (or leave blank for Anonymous)">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Campus Location *</label>
          <input type="text" id="postLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Library, Main Quad, Res Hall">
        </div>
        <textarea id="postContent" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-3" placeholder="What's happening on campus?"></textarea>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Add a photo</label>
          <input type="file" id="postImage" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <div id="postImagePreview" class="mt-2"></div>
        </div>
        <button onclick="createPost()" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-cyan-700 transition-all shadow-md hover:shadow-lg">
          ğŸ“¤ Share Post
        </button>
      </div>

      <div id="postsContainer" class="space-y-6"></div>
      <div id="noPosts" class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ“¸</div>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">No posts yet</h3>
        <p class="text-gray-500">Be the first to share a campus memory!</p>
      </div>

    </div><!-- /socializeSection -->
  </div><!-- /max-w-7xl -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCRIPT                                                -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    /* â”€â”€ localStorage helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const KEYS = { businesses:'cl_businesses', posts:'cl_posts', liked:'cl_liked' };

    function save(key, data) {
      try { localStorage.setItem(key, JSON.stringify(data)); }
      catch(e) { console.warn('CampLoci storage error:', e); }
    }
    function load(key, fallback) {
      try { const r = localStorage.getItem(key); return r ? JSON.parse(r) : fallback; }
      catch { return fallback; }
    }

    /* â”€â”€ Static data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const institutions = [
      'University of Cape Town','University of Witwatersrand','Stellenbosch University',
      'University of Pretoria','University of KwaZulu-Natal','Rhodes University',
      'University of the Free State','University of Johannesburg','Nelson Mandela University',
      'University of the Western Cape','North-West University','University of South Africa (UNISA)',
      'Cape Peninsula University of Technology','Durban University of Technology',
      'Tshwane University of Technology','Vaal University of Technology',
      'Walter Sisulu University','University of Limpopo','University of Venda',
      'University of Zululand','Sol Plaatje University','University of Mpumalanga',
      'Sefako Makgatho Health Sciences University','Mangosuthu University of Technology',
      'Central University of Technology','Cape Town Creative Academy',
      'Boland TVET College','Buffalo City TVET College','Capricorn TVET College',
      'Central Johannesburg TVET College','Coastal KZN TVET College','College of Cape Town TVET',
      'Eastern Cape Midlands TVET College','Ekurhuleni East TVET College','Ekurhuleni West TVET College',
      'Elangeni TVET College','Ehlanzeni TVET College','Esayidi TVET College',
      'False Bay TVET College','Flavius Mareka TVET College','Goldfields TVET College',
      'Gert Sibande TVET College','Ikhala TVET College','Ingwe TVET College',
      'King Hintsa TVET College','King Sabata Dalindyebo TVET College','Lephalale TVET College',
      'Letaba TVET College','Lovedale TVET College','Majuba TVET College',
      'Maluti TVET College','Mnambithi TVET College','Mopani South East TVET College',
      'Motheo TVET College','Nkangala TVET College','Northern Cape Urban TVET College',
      'Northlink TVET College','Orbit TVET College','Port Elizabeth TVET College',
      'Sekhukhune TVET College','Sedibeng TVET College','South Cape TVET College',
      'South West Gauteng TVET College','Taletso TVET College','Thekwini TVET College',
      'Tshwane North TVET College','Tshwane South TVET College','Umfolozi TVET College',
      'Umgungundlovu TVET College','Vhembe TVET College','Waterberg TVET College',
      'West Coast TVET College','Westcol TVET College'
    ];

    const categories = [
      {id:'all',       name:'All',              icon:'ğŸª'},
      {id:'tutoring',  name:'Tutoring',          icon:'ğŸ“š'},
      {id:'food',      name:'Food & Catering',   icon:'ğŸ•'},
      {id:'tech',      name:'Tech Services',     icon:'ğŸ’»'},
      {id:'fashion',   name:'Fashion & Beauty',  icon:'ğŸ‘—'},
      {id:'creative',  name:'Creative Services', icon:'ğŸ¨'},
      {id:'transport', name:'Transport',         icon:'ğŸš—'},
      {id:'events',    name:'Events',            icon:'ğŸ‰'},
      {id:'other',     name:'Other',             icon:'âœ¨'}
    ];

    const defaultBusinesses = [
      {id:1,name:'Campus Tutors Pro',category:'tutoring',owner:'Thabo Molefe',
       description:'Mathematics and Physics tutoring for all years. Experienced tutor with 95% pass rate.',
       institution:'University of Cape Town',price:'R150/hour',contact:'073 456 7890',
       rating:4.8,reviews:24,location:'Upper Campus',availability:'Mon-Fri, 18:00-21:00',image:null,ts:1000},
      {id:2,name:'Byte CafÃ© Delivery',category:'food',owner:'Lindiwe Nkosi',
       description:'Delicious homemade meals delivered to your res. Daily specials and bulk orders available.',
       institution:'University of Witwatersrand',price:'From R45',contact:'082 123 4567',
       rating:4.9,reviews:156,location:'West Campus Delivery',availability:'Daily, 11:00-20:00',image:null,ts:2000}
    ];

    /* â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let businesses      = load(KEYS.businesses, defaultBusinesses);
    let posts           = load(KEYS.posts, []);
    let likedBusinesses = load(KEYS.liked, []);

    let selectedInstitution = '';
    let selectedCategory    = 'all';
    let searchQuery         = '';
    let businessImageData   = null;
    let postImageData       = null;

    /* â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function init() {
      const selInst  = document.getElementById('institutionSelect');
      const selBizI  = document.getElementById('businessInstitution');
      const selPostI = document.getElementById('postInstitution');

      [...institutions].sort().forEach(inst => {
        [selInst, selBizI, selPostI].forEach(sel => {
          const o = document.createElement('option');
          o.value = inst; o.textContent = inst;
          sel.appendChild(o);
        });
      });

      /* category filter buttons */
      const catCont = document.getElementById('categoriesContainer');
      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn px-4 py-2 rounded-full whitespace-nowrap font-medium transition-all bg-white text-gray-700 hover:bg-gray-100 border border-gray-200';
        btn.innerHTML = `<span class="mr-1">${cat.icon}</span>${cat.name}`;
        btn.onclick = () => selectCategory(cat.id, btn);
        if (cat.id === 'all') btn.classList.add('active');
        catCont.appendChild(btn);
      });

      /* category dropdown in form */
      const bizCatSel = document.getElementById('businessCategory');
      categories.filter(c => c.id !== 'all').forEach(cat => {
        const o = document.createElement('option');
        o.value = cat.id; o.textContent = `${cat.icon} ${cat.name}`;
        bizCatSel.appendChild(o);
      });

      document.getElementById('institutionSelect').addEventListener('change', e => {
        selectedInstitution = e.target.value;
        renderBusinesses(); renderPosts();
      });
      document.getElementById('searchInput').addEventListener('input', e => {
        searchQuery = e.target.value; renderBusinesses();
      });
      document.getElementById('businessImage').addEventListener('change', e => readImage(e, v => businessImageData = v, 'businessImagePreview'));
      document.getElementById('postImage').addEventListener('change', e => readImage(e, v => postImageData = v, 'postImagePreview'));

      renderBusinesses();
      renderPosts();
    }

    function readImage(e, setter, previewId) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        setter(ev.target.result);
        document.getElementById(previewId).innerHTML = `<img src="${ev.target.result}" class="image-preview">`;
      };
      reader.readAsDataURL(file);
    }

    /* â”€â”€ TAB SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function switchMainTab(tab) {
      const isM = tab === 'market';
      document.getElementById('marketSection').classList.toggle('hidden', !isM);
      document.getElementById('socializeSection').classList.toggle('hidden', isM);
      setTabStyle('marketMainTab',    isM);
      setTabStyle('socializeMainTab', !isM);
    }
    function switchMarketTab(tab) {
      const isB = tab === 'browse';
      document.getElementById('browseSection').classList.toggle('hidden', !isB);
      document.getElementById('listSection').classList.toggle('hidden',   isB);
      setTabStyle('browseTab', isB);
      setTabStyle('listTab',   !isB);
    }
    function setTabStyle(id, active) {
      document.getElementById(id).className =
        `py-4 px-2 font-medium border-b-2 transition-colors ${active
          ? 'border-blue-600 text-blue-600'
          : 'border-transparent text-gray-500 hover:text-gray-700'}`;
    }
    function selectCategory(catId, btn) {
      selectedCategory = catId;
      document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderBusinesses();
    }

    /* â”€â”€ RENDER BUSINESSES (newest first) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderBusinesses() {
      const filtered = [...businesses]
        .sort((a, b) => (b.ts || 0) - (a.ts || 0))         // newest first
        .filter(b => {
          const matchI = !selectedInstitution || b.institution === selectedInstitution;
          const matchC = selectedCategory === 'all' || b.category === selectedCategory;
          const matchS = !searchQuery ||
            b.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
            b.description.toLowerCase().includes(searchQuery.toLowerCase());
          return matchI && matchC && matchS;
        });

      const grid = document.getElementById('businessesGrid');
      const none = document.getElementById('noResults');

      if (!filtered.length) { grid.innerHTML = ''; none.classList.remove('hidden'); return; }
      none.classList.add('hidden');

      grid.innerHTML = filtered.map(b => {
        const cat = categories.find(c => c.id === b.category) || categories[0];
        const liked = likedBusinesses.includes(b.id);
        return `
        <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-shadow overflow-hidden border border-gray-100">
          <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2"></div>
          ${b.image ? `<img src="${b.image}" class="w-full h-48 object-cover">` : ''}
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-800 mb-1">${b.name}</h3>
                <div class="flex items-center text-sm text-gray-600 mb-2">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <span>${b.owner}</span>
                </div>
              </div>
              <button onclick="toggleLike(${b.id})" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg class="w-5 h-5 ${liked ? 'fill-red-500 text-red-500' : 'text-gray-400'}" fill="${liked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
              </button>
            </div>
            <div class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium mb-3">${cat.icon} ${cat.name}</div>
            <p class="text-gray-600 mb-4 text-sm leading-relaxed">${b.description}</p>
            <div class="space-y-2 mb-4 text-sm text-gray-700">
              <div class="flex items-start">
                <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a2 2 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0zM15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span>${b.location}, ${b.institution}</span>
              </div>
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 flex-shrink-0 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>${b.availability}</span>
              </div>
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 flex-shrink-0 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a4 4 0 014-4z"/>
                </svg>
                <span class="font-semibold text-blue-700">${b.price}</span>
              </div>
            </div>
            ${b.rating > 0 ? `
            <div class="flex items-center mb-4 text-sm">
              <svg class="w-4 h-4 text-yellow-500 fill-yellow-500 mr-1" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <span class="font-semibold text-gray-800">${b.rating}</span>
              <span class="text-gray-500 ml-1">(${b.reviews} reviews)</span>
            </div>` : ''}
            <a href="tel:${b.contact}" class="w-full block bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-center text-sm font-medium">
              ğŸ“ Call ${b.contact}
            </a>
          </div>
        </div>`;
      }).join('');
    }

    function toggleLike(id) {
      likedBusinesses = likedBusinesses.includes(id)
        ? likedBusinesses.filter(x => x !== id)
        : [...likedBusinesses, id];
      save(KEYS.liked, likedBusinesses);
      renderBusinesses();
    }

    /* â”€â”€ SUBMIT BUSINESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function submitBusiness() {
      const f = {
        name:         document.getElementById('businessName').value.trim(),
        owner:        document.getElementById('ownerName').value.trim(),
        institution:  document.getElementById('businessInstitution').value,
        category:     document.getElementById('businessCategory').value,
        description:  document.getElementById('businessDescription').value.trim(),
        location:     document.getElementById('businessLocation').value.trim(),
        price:        document.getElementById('businessPrice').value.trim(),
        contact:      document.getElementById('businessContact').value.trim(),
        availability: document.getElementById('businessAvailability').value.trim()
      };
      if (Object.values(f).some(v => !v)) { alert('Please fill in all required fields'); return; }

      businesses.push({id:Date.now(), ts:Date.now(), ...f, rating:0, reviews:0, image:businessImageData});
      save(KEYS.businesses, businesses);

      ['businessName','ownerName','businessDescription','businessLocation',
       'businessPrice','businessContact','businessAvailability'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('businessInstitution').value = '';
      document.getElementById('businessCategory').value    = 'tutoring';
      document.getElementById('businessImage').value       = '';
      document.getElementById('businessImagePreview').innerHTML = '';
      businessImageData = null;

      switchMarketTab('browse');
      renderBusinesses();
      alert('Business listed successfully! ğŸ‰');
    }

    /* â”€â”€ CREATE POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function createPost() {
      const content     = document.getElementById('postContent').value.trim();
      const institution = document.getElementById('postInstitution').value;
      const location    = document.getElementById('postLocation').value.trim();
      const authorRaw   = document.getElementById('postAuthor').value.trim();
      const author      = authorRaw || 'Anonymous Student';

      if (!content)     { alert('Please write something to share!');    return; }
      if (!institution) { alert('Please select your institution!');      return; }
      if (!location)    { alert('Please specify your campus location!'); return; }

      posts.unshift({id:Date.now(), content, image:postImageData,
        institution, location, author,
        timestamp:new Date().toLocaleString(),
        likes:[], comments:[]});
      save(KEYS.posts, posts);

      document.getElementById('postContent').value     = '';
      document.getElementById('postInstitution').value = '';
      document.getElementById('postLocation').value    = '';
      document.getElementById('postAuthor').value      = '';
      document.getElementById('postImage').value       = '';
      document.getElementById('postImagePreview').innerHTML = '';
      postImageData = null;

      renderPosts();
    }

    /* â”€â”€ RENDER POSTS (newest first via unshift) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderPosts() {
      const filtered  = posts.filter(p => !selectedInstitution || p.institution === selectedInstitution);
      const container = document.getElementById('postsContainer');
      const noPosts   = document.getElementById('noPosts');

      if (!filtered.length) {
        container.innerHTML = '';
        noPosts.classList.remove('hidden');
        return;
      }
      noPosts.classList.add('hidden');

      container.innerHTML = filtered.map(p => {
        const liked = p.likes.includes('user');
        const commentsHTML = p.comments.length
          ? p.comments.map(c => `
              <div class="comment-box">
                <span class="font-semibold text-gray-800 text-sm">${escHtml(c.author)}</span>
                <span class="text-xs text-gray-400 ml-2">${c.timestamp}</span>
                <p class="text-gray-700 text-sm mt-1">${escHtml(c.text)}</p>
              </div>`).join('')
          : '';

        return `
        <div class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden" id="post-${p.id}">
          <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-1"></div>
          <div class="p-6">
            <!-- Author row -->
            <div class="flex items-start justify-between mb-3">
              <div>
                <div class="font-semibold text-gray-800">${escHtml(p.author)}</div>
                <div class="text-xs text-gray-400">${p.timestamp}</div>
                <div class="text-xs text-blue-600 mt-0.5">ğŸ“ ${escHtml(p.location)}, ${escHtml(p.institution)}</div>
              </div>
            </div>

            <!-- Content -->
            <p class="text-gray-700 mb-2 leading-relaxed">${escHtml(p.content)}</p>
            ${p.image ? `<img src="${p.image}" class="post-image">` : ''}

            <!-- Action bar -->
            <div class="flex items-center space-x-6 mt-4 pt-4 border-t border-gray-100">
              <button onclick="likePost(${p.id})"
                class="flex items-center space-x-1.5 font-medium text-sm transition-colors ${liked ? 'text-red-500' : 'text-gray-500 hover:text-red-500'}">
                <svg class="w-5 h-5" fill="${liked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span>${p.likes.length} ${p.likes.length === 1 ? 'Like' : 'Likes'}</span>
              </button>

              <button onclick="toggleCommentBox(${p.id})"
                class="flex items-center space-x-1.5 font-medium text-sm text-gray-500 hover:text-blue-600 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                <span>${p.comments.length} ${p.comments.length === 1 ? 'Comment' : 'Comments'}</span>
              </button>
            </div>

            <!-- Comments list -->
            ${commentsHTML ? `<div class="mt-4 space-y-2">${commentsHTML}</div>` : ''}

            <!-- Comment input (hidden by default) -->
            <div id="commentBox-${p.id}" class="hidden mt-4">
              <div class="flex gap-2">
                <input type="text" id="commentName-${p.id}"
                  placeholder="Your name (optional)"
                  class="w-36 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent flex-shrink-0">
                <input type="text" id="commentText-${p.id}"
                  placeholder="Write a commentâ€¦"
                  class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                  onkeydown="if(event.key==='Enter') addComment(${p.id})">
                <button onclick="addComment(${p.id})"
                  class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors flex-shrink-0">
                  Post
                </button>
              </div>
            </div>
          </div>
        </div>`;
      }).join('');
    }

    /* â”€â”€ LIKE POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function likePost(id) {
      const post = posts.find(p => p.id === id);
      if (!post) return;
      post.likes = post.likes.includes('user')
        ? post.likes.filter(u => u !== 'user')
        : [...post.likes, 'user'];
      save(KEYS.posts, posts);
      renderPosts();
    }

    /* â”€â”€ COMMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function toggleCommentBox(id) {
      const box = document.getElementById(`commentBox-${id}`);
      if (box) {
        box.classList.toggle('hidden');
        if (!box.classList.contains('hidden')) {
          document.getElementById(`commentText-${id}`).focus();
        }
      }
    }

    function addComment(postId) {
      const textEl = document.getElementById(`commentText-${postId}`);
      const nameEl = document.getElementById(`commentName-${postId}`);
      const text   = textEl.value.trim();
      const name   = nameEl.value.trim() || 'Anonymous';

      if (!text) { textEl.focus(); return; }

      const post = posts.find(p => p.id === postId);
      if (!post) return;

      post.comments.push({
        author: name,
        text,
        timestamp: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
      });
      save(KEYS.posts, posts);
      renderPosts();

      // keep comment box open after re-render
      const box = document.getElementById(`commentBox-${postId}`);
      if (box) box.classList.remove('hidden');
    }

    /* â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function escHtml(str) {
      return String(str)
        .replace(/&/g,'&amp;').replace(/</g,'&lt;')
        .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    init();
  </script>
</body>
</html>